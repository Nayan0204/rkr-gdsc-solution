<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            height: 100vh;
            display: grid;
            place-content: center;
        }

        div {
            display: flex;
            flex-direction: column;
        }

        .table {
            flex-direction: row;
            gap: 10px;
        }
    </style>
</head>

<body>

    <div>
        <input placeholder="City" type="city" id="city" />
        <!-- <input placeholder="Id" type="id" id="id" />
        <input placeholder="Organization" type="organization" id="organization">
        <input placeholder="Address" type="address" id="address" />
        <input placeholder="Latitude" type="latitude" id="latitude" />
        <input placeholder="Longitude" type="longitude" id="longitude" /> -->


    </div>
    <div>
        <button id="submit">Submit</button>
        <button id="locate">Start</button>
        <h1 id="place"></h1>
    </div>
    <div class="table">
        <h1 id="ids">id : <br /> </h1>
        <h1 id="addresses">address : <br /></h1>
        <h1 id="organizations">organization : <br /> </h1>
        <h1 id="latitudes">latitude : <br /></h1>
        <h1 id="longitudes">longitude : <br /> </h1>
    </div>

    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";


        const firebaseConfig = {
            apiKey: "AIzaSyBArOVoz0GEbbHzROw3CQy21xKzJZZBoyg",
            authDomain: "gdsc-solution-d963e.firebaseapp.com",
            databaseURL: "https://gdsc-solution-d963e-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gdsc-solution-d963e",
            storageBucket: "gdsc-solution-d963e.appspot.com",
            messagingSenderId: "868921508827",
            appId: "1:868921508827:web:4fb017bdd70b8a4ad19dfe",
            measurementId: "G-Q8HQPBRYC8"
        };


        const app = initializeApp(firebaseConfig);

        import { getDatabase, ref, child, get, set, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const db = getDatabase();

        let SubmitBtn = document.getElementById("submit");

        function save() {
            var city = document.getElementById("city").value;
            var id = document.getElementById("id").value;
            var organization = document.getElementById("organization").value;
            var address = document.getElementById("address").value;
            var latitude = document.getElementById("latitude").value;
            var longitude = document.getElementById("longitude").value;
            set(ref(db, "city/" + city + "/" + "id" + id), {

                organization: organization,
                address: address,
                latitude: latitude,
                longitude: longitude,



            }).then(() => {
                alert("saved");
                location.reload();

            })
                .catch((error) => {
                    alert('error');
                    console.log(error);
                })
        }

        const lula = (t, path) =>
            path.split(".").reduce((r, k) => r?.[k], t)

        function getData() {
            var city = document.getElementById("city").value;

            const dbRef = ref(db);

            get(child(dbRef, 'city/' + city)).then((snapshot) => {
                if (snapshot.exists()) {

                    for (var i = 0; i < Object.keys(snapshot.val()).length; i++) {
                        document.getElementById("addresses").innerHTML += lula(snapshot.val(), `id${i + 1}.address`);
                    }

                }
                else {
                    alert("id does not exist");
                }
            })
                .catch((error) => {
                    alert("error");
                    console.log(error);
                });
        }

        function clearInput() {
            var city = document.getElementById("city").value;
            var id = document.getElementById("id").value;
            var organization = document.getElementById("organization").value;
            var address = document.getElementById("address").value;
            var latitude = document.getElementById("latitude").value;
            var longitude = document.getElementById("longitude").value;

            city = "";
            id = "";
            organization = "";
            address = "";
            latitude = "";
            longitude = "";
        }

        SubmitBtn.addEventListener("click", getData);




    </script>
    <script>
        const start = document.querySelector('#locate');

        start.addEventListener("click", () => {
            navigator.geolocation.getCurrentPosition(showCity)
        })

        // First, get the user's location coordinates using the Geolocation API


        // Then, pass the location coordinates to a Geocoding API to get the city name
        function showCity(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            console.log(latitude, longitude);

            // Make a request to a Geocoding API (e.g. Google Maps Geocoding API)
            const url = `http://api.openweathermap.org/geo/1.0/reverse?lat=${latitude}&lon=${longitude}&limit=5&appid=23487240e250933e64cd979430f95138`;

            fetch(url)
                .then((response) => response.json())
                .then((data) => {
                    // Parse the city name from the API response
                    const city = data[0].name;

                    console.log(city);
                    document.getElementById('place').innerHTML = city;
                })
                .catch((error) => console.log(error));
        }
    </script>

</body>

</html>